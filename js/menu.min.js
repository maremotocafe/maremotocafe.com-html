'use strict';class Menu{constructor(initialItems,incrementLoad){this.numItems=0;this.initialItems=initialItems;this.incrementLoad=incrementLoad;this.curFilter='all';this.firstTime=true;}
setup(itemsId,popUpsId){this.container=document.querySelector('.shuffle-wrapper');this.allInputs=Array.from(document.querySelectorAll('input[name="shuffle-filter"]'));this.toggableFilters=document.querySelectorAll('.menu-filter:not([filter-level="1"])');this.noItemsMsg=document.getElementById('no-items-msg');this.loadMoreBtn=document.getElementById('load-more-btn');this.setupShuffle();this.setupListeners();this.setupItems(itemsId,popUpsId);}
setupShuffle(){this.shuffle=new window.Shuffle(this.container,{itemSelector:'.shuffle-item',buffer:1,useTransforms:false});Array.from(document.getElementsByClassName('lozad')).forEach(img=>img.addEventListener('load',()=>this.shuffle.layout()));}
setupListeners(){this.allInputs.forEach(item=>{item.addEventListener('click',e=>this.onInputClick(e))});this.loadMoreBtn.addEventListener('click',e=>{this.onLoadMoreClicked(e)});}
setupItems(itemsId,popUpsId){this.items=Array.from(document.getElementById(itemsId).children);this.items.forEach(element=>{this.shuffle.element.appendChild(element);});}
getBar(filter){return filter.children[1];}
barContains(bar,value){return Array.from(bar.children).some(i=>i.children[0].getAttribute('filter-value')===value);}
resetFilter(filter){function deactivate(el){el.classList.remove('active');el.classList.checked=false;}
function activate(el){el.classList.add('active');el.classList.checked=true;}
let bar=this.getBar(filter);let active=Array.from(bar.children).find(i=>i.classList.contains('active'));let inactive=bar.children[0];deactivate(active);activate(inactive);}
hideFilter(filter){const filterJQ=$(filter);if(filterJQ.is(':hidden')){return}
this.resetFilter(filter);filterJQ.css('opacity',1);filterJQ.addClass('d-none');filterJQ.animate({opacity:0},400);}
showFilter(filter){const filterJQ=$(filter);if(!filterJQ.is(':hidden')){return}
filterJQ.css('opacity',0);filterJQ.removeClass('d-none');filterJQ.animate({opacity:1},400);}
updateFilters(curBar,curParent,curFilter){this.toggableFilters.forEach(filter=>{const filterParent=filter.getAttribute('filter-parent');let bar=this.getBar(filter);if(bar===curBar||this.barContains(bar,curParent)||filterParent===curFilter)
{this.showFilter(filter);if(filterParent===curFilter){this.resetFilter(filter);}}else{this.hideFilter(filter);}});}
updateItems(filter){if(this.firstTime){this.shuffle.add(this.items);this.firstTime=false;}
if(this.curFilter!==filter){this.numItems=this.initialItems;this.curFilter=filter;}
let numMatches=0;this.shuffle.filter(item=>{const dataGroups=JSON.parse(item.getAttribute('data-groups'));if(filter==='all'||dataGroups.some(field=>field===filter)){numMatches++;if(numMatches<=this.numItems){return true;}}
return false;});if(numMatches===0){this.noItemsMsg.classList.remove('d-none');}else{this.noItemsMsg.classList.add('d-none');}
if(numMatches<=this.numItems){this.loadMoreBtn.classList.add('d-none');}else{this.loadMoreBtn.classList.remove('d-none');}
this.shuffle.update();}
onInputClick(e){const clickedInput=e.currentTarget;const clickedFilter=clickedInput.getAttribute('filter-value');const clickedBar=clickedInput.parentNode.parentNode;const clickedParent=clickedBar.parentNode.getAttribute('filter-parent');this.updateFilters(clickedBar,clickedParent,clickedFilter);this.updateItems(clickedFilter);}
onLoadMoreClicked(e){this.numItems+=this.incrementLoad;this.updateItems(this.curFilter);}}
window.Menu=Menu;